
@{
    Layout = null;
}
<style>
    .la {
        margin-left: -50px;
    }
</style>
<div class="templatemo-content-wrapper">
    <div class="templatemo-content">
        <ol class="breadcrumb">
            <li><a href="index.html">Admin Panel</a></li>
            <li><a href="#">Dashboard</a></li>
            <li class="active">Overview</li>
            <li><a href="sign-in.html">Sign In Form</a></li>
        </ol>
        <h1>Dashboard</h1>
        <div class="margin-bottom-30">
            <div class="row">
                <div class="col-md-12">
                    <ul class="nav nav-pills">
                        <li class="active"><a href="#">Home <span class="badge">42</span></a></li>
                        <li class="active"><a href="#">Profile <span class="badge">126</span></a></li>
                        <li class="active"><a href="#">Messages <span class="badge">14</span></a></li>
                    </ul>
                </div>
            </div>
        </div>
        <form class="form-horizontal" role="form" id="SerchTeachs">
            <div class="margin-bottom-30">
                <div class="row">
                                        
                            <label class="control-label">登录名：  </label>
                            <input type="text" class="" name="LName" placeholder="请输入登录名">
                       
                   
                    
                            <label class="control-label">老师姓名：</label>
                            <input type="text"  name="tName" placeholder="请输入姓名">
                   
                
                  
                      
                            <label class="control-label">老师电话：</label>
                            <input type="tel" name="tTel" placeholder="请输入电话">
                       
                    
                               
                          
                                <label class="control-label">教员/督导：</label>
                                <select name="tRole">
                                    <option value="0">==请选择==</option>
                                    <option value="1">教员</option>
                                    <option value="2">督导</option>
                                </select>
                                                   
                   
                    
                          <button type="button" id="searchTeacher" class="btn-default">查询</button>
                        <button type="button" id="addTeacher" class="btn-default" data-toggle="modal" data-target="#Modal" data-backdrop="static">新增</button>
                   
                </div>
            </div>           
              
               
          
            <div class="form-group" style="display:none">              
                <input type="text" class="form-control" name="pageIndex"  id="page">
            </div>   
                              
         
        </form>

        <table class="table">
            <thead>
                <tr>
                    <th>老师姓名</th>
                    <th>老师性别</th>
                    <th>老师电话</th>
                    <th>教员/督导</th>
                    <th>登录名</th>
                    <th>系统角色</th>
                    <th>是否可用</th>
                    <th>上次登录时间</th>
                    <th>操作</th>
                    <th>启用/禁用</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <ul class="pagination">
            <li><a href="#">&laquo;</a></li>
            <li class="active"><a href="#">1</a></li>
            <li class="disabled"><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">&raquo;</a></li>

        </ul>

    </div>
</div>
<div class="modal fade" id="updatePwdModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">更改密码</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="getTeacherTID" role="form">   
                    <div class="form-group" id="loginPwd" >
                        <label for="txtAddShopName" class="col-md-4 control-label">请输入管理员密码：</label>
                        <div class="col-lg-6">
                            <input type="password" class="form-control m-b-10" id="adminTPwd"  placeholder="请添加管理员">
                        </div>
                    </div>                
                    <div class="form-group" id="loginPwd">
                        <label for="txtAddShopName" class="col-md-4 control-label">用户修改后的登录密码：</label>
                        <div class="col-lg-6">
                            <input type="password" class="form-control m-b-10" id="userTPwd"  placeholder="请添加用户密码">
                        </div>
                    </div>                                
                    <div class="form-group" style="display:none">
                        <div>
                            <input type='text' id="txtID"  value="0">
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> 关 闭</button>
                <button type="button" class="btn btn-primary" id="update"><i class="fa fa-floppy-o"></i> 修改密码</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<div  class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel"></h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="getTeacherTID" role="form">
                    <div class="form-group">
                        <label for="txtAddShopName" class="col-md-4 control-label">老师姓名：</label>
                        <div class="col-lg-6">
                            <input type="text" class="form-control m-b-10" id="addTName" name="T_Name" placeholder="请添加姓名">
                        </div>
                    </div>
                    <div class="form-group" id="loginPwd" style="display:none">
                        <label for="txtAddShopName" class="col-md-4 control-label">登录密码：</label>
                        <div class="col-lg-6">
                            <input type="password" class="form-control m-b-10" id="addTPwd" name="T_Pwd" placeholder="请添加姓名">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="txtAddShopName" class="col-md-4 control-label">老师性别：</label>
                        <div class="col-lg-6">
                            <input type="radio"  name="T_Sex" value="男" checked="checked" >男
                            <input type="radio" name="T_Sex" value="女">女
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="txtAddShopName" class="col-md-4 control-label">老师电话：</label>
                        <div class="col-lg-6">
                            <input type="tel" class="form-control m-b-10" id="addTTel" name="T_Tel" placeholder="请添加电话">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="txtAddShopName" class="col-md-4 control-label">登录名：</label>
                        <div class="col-lg-6">
                            <input type="text" class="form-control m-b-10" id="addTlogName" name="T_LoginName" placeholder="请添加校区代码">
                        </div>
                    </div>
                    <div class="form-group" id="provinces">
                        <label for="txtAddShopPerson" class="col-md-4 control-label">教员/督导：</label>
                        <div class="col-lg-6">
                            <select id="addTCate" name="T_CateGory">
                                <option value="">==请选择==</option>
                                <option value="1">教员</option>
                                <option value="2">督导</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="provinces">
                        <label for="txtAddShopPerson" class="col-md-4 control-label">系统角色：</label>
                        <div class="col-lg-6">
                            <select id="addTRole" name="T_Role">
                                <option value="">==请选择==</option>
                                <option value="1">教员</option>
                                <option value="2">督导</option>
                                <option value="3">管理员</option>
                            </select>
                        </div>
                    </div>
                  
                    <div class="form-group" style="display:none">
                        <div>
                            <input type='text' id="tID" name='T_ID' value="0">
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> 关 闭</button>
                <button type="button" class="btn btn-primary" id="Save"><i class="fa fa-floppy-o"></i> 提 交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<script>
        //删除校区函数
        function del(tID, pageIndex) {
            $.getJSON("/Teachers/Del", { tID: tID}, function (res) {

                if (res ==true)
                {
                        Serach(pageIndex);
                }
                else
                {
                    alert(res);
                }

            });

        };
        //修改校区函数
        function updateSchool(tID)
        {

            $("#Modal").modal("show");
            $("#myModalLabel").text("修改用户");
            $("#loginPwd").hide();         
            $.getJSON("/Teachers/GetTeacherTID", { tID: tID }, function (res) {
                if(res==null)
                {
                    alert("该用户已不存在，请刷新页面");
                }
                else
                {
                    $("#addTName").val(res.T_Name);
                    $("#addTPwd").val(res.T_Pwd);
                    
                    $(":radio[name='T_Sex']").each(function () {                     
                        if($(this).val()==res.T_Sex)
                        {
                            $(this).prop("checked", true);
                        }

                    });
                    $("#addTTel").val(res.T_Tel);
                    $("#addTlogName").val(res.T_LoginName);
                    $("#addTCate").val(res.T_Category);
                    $("#addTRole").val(res.T_Role);
                    $("#tID").val(res.T_ID);
                }
            });
        }
        //查询数据
        function Serach(pageIndex) {
           
            $("#page").val(pageIndex);
            $.get("/Teachers/GetTeachersView", $("#SerchTeachs").serialize(), function (res) {
                $(".table tbody").empty();
                if (res.rows.length == 0)
                {
                    if (pageIndex > 1)
                        Serach(pageIndex - 1);
                }
                else
                {
                    for (var t = 0; t < res.rows.length; t++) {
                        if (res.rows[t].T_Role == 1)
                            var teach = "教员";
                        else if (res.rows[t].T_Role == 2)
                            var teach = "督导";
                        else
                            var teach = "系统管理员";
                        //alert(teach);
                        var add = $("<tr>" +
                                "<td>" + res.rows[t].T_Name + "</td>" +
                                "<td>" + res.rows[t].T_Sex+ "</td>" +
                                "<td>" + res.rows[t].T_Tel + "</td>" +
                                "<td>" + (res.rows[t].T_Category == 1 ? "教员" : "督导") + "</td>" +                              
                                "<td>" + res.rows[t].T_LoginName + "</td>" +
                                "<td>" + teach + "</td>" +
                                "<td>" + (res.rows[t].T_IsEnabled == 1 ? "已启用" : "已禁用") + "</td>" +                              
                                "<td>" + ChangeDateTimeFormat(res.rows[t].T_LastLoginTime) + "</td>" +
                                "<td><button onclick=updateSchool(" + res.rows[t].T_ID + ") type=\"button\" class=\"btn btn-success\">修改</button>" +
                                "<button onclick=updatePwd(" + res.rows[t].T_ID + ") type=\"button\" class=\"btn btn-warning\">更改密码</button>" +
                                (res.rows[t].T_Role!=3?"<button type=\"button\" onclick=\"del('" + res.rows[t].T_ID + "','" + pageIndex + "')\" class=\"btn btn-danger\">删除</button>":"")+
                                "</td>" +
                                "<td><button onclick=IsEnabled(" + res.rows[t].T_ID + ") type=\"button\" class='btn " + (res.rows[t].T_IsEnabled == 1 ? "btn-warning" : "btn-success") + "'>" + (res.rows[t].T_IsEnabled == 1 ? "禁用" : "启用") + "</button></td>" +
                                "</tr>"
                        )
                      
                        $(".table tbody").append(add);

                        //alert($(".table tbody tr:last").html());
                    }
                    $(".pagination").empty();
                    if (pageIndex == 1)
                        $(".pagination").append("<li class=\"disabled\" ><a href=\"#\">&laquo;</a></li>");
                    else
                        $(".pagination").append("<li onclick=\"Serach(1)\" ><a href=\"#\">&laquo;</a></li>");                   
                    if (pageIndex > 3) {
                        for (var t = pageIndex - 2; t < pageIndex + 3; t++) {

                            if (pageIndex == t)
                                $(".pagination").append("<li  class=\"active\"><a href=\"#\">" + t + "</a></li>");
                            else
                                $(".pagination").append("<li onclick=\"Serach(" + t + ")\"> <a href=\"#\">" + t + "</a></li>");
                            if (t == res.total) {
                                break;
                            }

                        }
                    }
                    else {
                        for (var t = 1; t <= res.total; t++) {
                            if (pageIndex == t)
                                $(".pagination").append("<li  class=\"active\"><a href=\"#\">" + t + "</a></li>");
                            else
                                $(".pagination").append("<li onclick=\"Serach(" + t + ")\" >  <a href=\"#\">" + t + "</a></li>");
                            if (t == 5) {
                                break;
                            }
                        }
                    }
                    if (pageIndex == res.total)
                        $(".pagination").append("<li class=\"disabled\"><a href=\"#\">&raquo;</a></li>");
                    else
                        $(".pagination").append("<li onclick=\"Serach(" + res.total + ")\" ><a href=\"#\">&raquo;</a></li>");
                }


            });

        }

        $("#Modal").on('hidden.bs.modal', function () {
            //$("#getTeacherTID input").val("");
            //$("#getTeacherTID select").val("");
            $("#getTeacherTID").each(function () {
               this.reset();
            })


        });
    //设置是否可用
        function IsEnabled(tID) {
            $.get("/Teachers/IsEnabled", { tID: tID }, function (res) {
                if (res == "1")
                    Serach($("#page").val());
                else
                    alert("设置失败，请重试");

            }),"text"

        };
       //更改密码
        function updatePwd(tID) {
            $("#txtID").val(tID);
            $("#updatePwdModal").modal("show");
        };
       
        $().ready(function () {
            Serach(1);
            $("#searchTeacher").click(function () {
                Serach(1);
            });
            $("#Save").click(function () {                                        
                if ($("#addTName").val() == "") {
                    alert("姓名不能为空");
                    return;
                }
                if ($("#addTPwd").val() == "") {
                    alert("密码不能为空");
                    return;
                }
                if ($("#addTPwd").val() == "") {
                    alert("密码不能为空");
                    return;
                }
                if ($("#addTTel").val() == "") {
                    alert("电话不能为空");
                    return;
                }
                if ($("#addTlogName").val() == "") {
                    alert("登录名不能为空");
                    return;
                }                                             
                if ($("#addTCate option:selected").val() == "")
                {
                    alert("请选择教员还是督导");
                    return;
                }
                if ($("#addTRole option:selected").val() == "") {
                    alert("请选择系统身份");
                    return;
                }
                $.ajax({
                    url: "/Teachers/AddOrUpdate",
                    type: "post",
                    async: true,
                    data: $("#getTeacherTID").serialize(),
                    dataType: "text",
                    success: function (res) {
                        if(res=="update")
                        {
                            $("#Modal").modal("hide");
                            Serach($("#page").val());
                        }
                        else if(res=="add")
                        {
                            $("#Modal").modal("hide");
                            Serach(1);
                        }
                        else
                        {
                            alert(res);
                        }

                    }
                });

            });           
            $("#update").click(function () {
                var tid = $("#txtID").val();
                var adminPwd = $("#adminTPwd").val();
                var userPwd = $("#userTPwd").val();
                $.get("/Teachers/UpdatePwd", { tid: tid, adminPwd: adminPwd, userPwd:userPwd }, function (res) {
                    if (res == "1")
                    {
                        $("#txtID").val("");
                        $("#adminTPwd").val("");
                        $("#userTPwd").val("");
                        $("#updatePwdModal").modal("hide");

                    }                        
                    else
                        alert(res);

                }), "text"

            });
            $("#addTeacher").click(function () {
                $("#myModalLabel").text("新增用户");
                $("#loginPwd").show();
            });
        });
</script>
